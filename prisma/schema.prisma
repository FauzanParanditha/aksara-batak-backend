generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  judge
}

enum EntryStatus {
  draft
  submitted
  reviewed
  disqualified
}

enum JudgingStage {
  preliminary
  semifinal
  final
}

model User {
  id                     String   @id @default(cuid())
  fullName               String
  email                  String   @unique
  passwordHash           String
  role                   Role
  isVerified             Boolean  @default(false)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?

  scores                 Score[]  @relation("JudgeScores")
}

model Registrar {
  id         String         @id @default(cuid())
  name       String         @unique
  website    String?
  email      String?
  createdAt  DateTime       @default(now())

  domains    DomainEntry[]  @relation("RegistrarDomains")
}

model DomainEntry {
  id           String        @id @default(cuid())
  domainName   String        @unique
  description  String?
  registrar    Registrar     @relation("RegistrarDomains", fields: [registrarId], references: [id])
  registrarId  String
  status       EntryStatus   @default(draft)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  scores       Score[]
}

model ScoringCriteria {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  weight      Float    @default(1.0)
  createdAt   DateTime @default(now())

  scores      Score[]
}

model Score {
  id           String            @id @default(cuid())
  judge        User              @relation("JudgeScores", fields: [judgeId], references: [id])
  judgeId      String

  domain       DomainEntry       @relation(fields: [domainId], references: [id])
  domainId     String

  criteria     ScoringCriteria   @relation(fields: [criteriaId], references: [id])
  criteriaId   String

  score        Float
  comment      String?
  stage        JudgingStage      @default(preliminary)

  createdAt    DateTime          @default(now())
}
